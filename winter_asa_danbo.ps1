##################################################
#
# 暖房器具をON, OFFする
#
# 引数： ON: スイッチON
#        OFF: スイッチOFF
#        LIGHT: 照明ON
#
##################################################
# ========== 定数 ==========
# ログ保存パス
$LOG_FILE = [System.Environment]::GetFolderPath("MyDocuments") + "\remocon.log"
# ========== リモコン信号 ==========
# サーキュレーター電源
$CIRCULATOR_POWER = '{"format":"raw","freq":38,"data":[17421,8755,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,968,1190,968,1190,968,1190,968,1190,968,1190,968,1190,968,1190,968,1190,3228,1190,3228,1190,3228,1190,3228,1190,3228,1190,3228,1190,3228,1190,3228,1190,65535,0,14668,17421,4251,1190]}'
# サーキュレーター 強
$CIRCULATOR_HIGH  = '{"format":"raw","freq":38,"data":[17421,8755,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,968,1190,968,1190,968,1190,3228,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,65535,0,14668,17421,4251,1190,65535,0,65535,0,58076,17421,4251,1190]}'
# サーキュレーター 中
$CIRCULATOR_MIDDLE = '{"format":"raw","freq":38,"data":[17421,8755,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,1002,1190,1002,1190,3228,1190,3228,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,3228,1190,1002,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,65535,0,14668,17421,4251,1190,65535,0,65535,0,58076,17421,4251,1190]}'
# サーキュレーター タイマー２時間
$CIRCULATOR_2H = '{"format":"raw","freq":38,"data":[17421,8755,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,1002,1190,3228,1190,3228,1190,3228,1190,1002,1190,1002,1190,1002,1190,1002,1190,3228,1190,1002,1190,1002,1190,1002,1190,3228,1190,3228,1190,3228,1190,3228,1190,65535,0,14668,17421,4251,1190,65535,0,65535,0,58076,17421,4251,1190,65535,0,65535,0,58076,17421,4251,1190,65535,0,65535,0,58076,17421,4251,1190]}'
# エアコン ON
$AIR_CONDITIONE_ON = '{"format":"raw","freq":38,"data":[6881,3341,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2451,904,2451,904,2451,904,787,968,787,968,2451,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,19315,6881,3341,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,2537,904,2537,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,2537,904,2537,904,787,904,2537,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,2537,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,2537,904,787,904,787,904,2537,904]}'
# エアコン OFF
$AIR_CONDITIONE_OFF = '{"format":"raw","freq":38,"data":[6881,3341,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,19315,6881,3341,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,2537,904,2537,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,2537,904,2537,904,2537,904,787,904,2537,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,787,904,2537,904,2537,904,787,904,2537,904,787,904,787,904,787,904,2537,904,787,904,2537,904,2537,904,2537,904,787,904,787,904,2537,904]}'
# 照明 ON
$LIGHT_ON ='{"format":"raw","freq":38,"data":[6881,3341,904,815,904,815,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,815,904,815,904,2537,904,815,904,2537,904,815,904,2537,904,815,904,815,904,2537,904,2537,904,2537,904,815,904,815,904,815,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,2537,904,2537,904,815,904,815,904,2537,904,2537,904,815,904,2537,904,65535,0,65535,0,27246,6881,3341,904,815,904,815,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,815,904,815,904,2537,904,815,904,2537,904,815,904,2537,904,815,904,815,904,2537,904,2537,904,2537,904,815,904,815,904,815,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,2537,904,2537,904,815,904,815,904,2537,904,2537,904,815,904,2537,904]}'
# 照明（全灯） ON
$LIGHT_ZENTO_ON ='{"format":"raw","freq":38,"data":[6648,3458,787,935,787,935,787,2626,787,2626,787,935,787,2626,787,935,787,935,787,935,787,2626,787,935,787,935,787,2626,787,935,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,935,787,935,787,935,787,935,787,935,787,2626,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,935,787,65535,0,65535,0,27246,6648,3458,787,935,787,935,787,2626,787,2626,787,935,787,2626,787,935,787,935,787,935,787,2626,787,935,787,935,787,2626,787,935,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,935,787,935,787,935,787,935,787,935,787,2626,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,2626,787,935,787,935,787,2626,787,935,787,935,787]}'
# 照明 OFF
$LIGHT_OFF = '{"format":"raw","freq":38,"data":[6881,3341,904,815,904,815,904,2451,904,2451,904,815,904,2537,904,815,904,815,904,815,904,2537,904,815,904,815,904,2537,904,815,904,2537,904,815,904,2537,904,815,904,815,904,2537,968,761,904,761,904,761,904,761,904,2537,904,2537,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,2537,904,815,904,815,904,2537,904,815,904,815,904,65535,0,65535,0,27246,6881,3341,904,815,904,815,904,2537,904,2537,904,761,904,2537,904,815,904,815,904,815,904,2537,904,815,904,815,904,2537,904,815,935,2451,904,815,904,2537,904,815,904,815,904,2537,904,815,935,815,935,815,935,815,935,2537,904,2537,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,2537,904,815,904,815,904,2537,904,815,904,815,904,65535,0,65535,0,27246,6881,3341,904,815,904,815,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,815,904,815,904,2537,904,815,904,2537,904,815,904,2537,904,815,904,815,904,2537,904,815,904,815,904,815,904,815,904,2537,904,2537,904,2537,904,2537,904,815,904,2537,904,815,904,815,904,815,904,2537,904,2537,904,815,904,815,904,2537,904,815,904,815,904]}'
# ========== ON, OFF信号 ==========
# ONにするもの
#   順番に注意。サーキュレーターは電源ONしてから風量調節すること
$ON_SIGNALS  = [ordered]@{"エアコンON"=$AIR_CONDITIONE_ON; "サーキュレーターON"=$CIRCULATOR_POWER; "サーキュレーター中"=$CIRCULATOR_MIDDLE; "サーキュレータータイマー（２時間）"=$CIRCULATOR_2H;}

# OFFにするもの
#   サーキュレーターはON, OFFの区別はないため送信しないこと
$OFF_SIGNALS = [ordered]@{"エアコン"=$AIR_CONDITIONE_OFF; "照明OFF"=$LIGHT_OFF}

# 照明に関するもの
$LIGHT_SIGNALS = [ordered]@{"照明ON（全灯）"=$LIGHT_ZENTO_ON;}

# ========== 関数 ==========
function log() {
    $log_date = "[ "
    $log_date += Get-Date -Format "G"
    $log_date += " ]"

    $contents = ""
    foreach ($content in $args) {
        $contents += $content
        $contents += " "
    }

    $log_date + " " + $contents | Out-File -Append $LOG_FILE
}

# ========== メイン処理 ==========
log "========== 処理スタート =========="
log "引数:" $args[0]

if ($args[0] -eq "ON") {
    $SIGNALS = $ON_SIGNALS
} elseif ($args[0] -eq "OFF") {
    $SIGNALS = $OFF_SIGNALS
} elseif ($args[0] -eq "LIGHT") {
    $SIGNALS = $LIGHT_SIGNALS
} else {
    log "引数が不正です" $args[0]
    exit 1
}

foreach ($key in $SIGNALS.Keys) {
    log $key " 実行"
    Invoke-RestMethod -Uri "http://192.168.0.4/messages" -Method Post -Headers @{"X-Requested-With"="curl"} -Body $SIGNALS[$key]
    Start-Sleep -s 5
}

log "終了"